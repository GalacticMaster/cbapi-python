# ThreatIntel Module
Python3 module that can be used in the development of Threat Intelligence Connectors for the Carbon Black Cloud.

## Introduction
This document describes how to use the ThreatIntel Python3 module for development of connectors that retrieve Threat Intelligence and import it into a Carbon Black Cloud instance.

The ThreatIntel `push_to_cb` method expects a list of objects that have five attributes:
`id, timestamp, title, description, and severity`. For these objects, may use the pre-built `AnalysisResult` class from `results.py`, which has these attributes already, or build your own custom class.



### Files

#### `threatintel.py`

Contains the `ThreatIntel` class. This converts Threat Intelligence from result dictionaries into ThreatHunter `Reports`, and then sends them to a ThreatHunter `Feed`.

#### `results.py`

Contains the `AnalysisResult` and `IOC` classes. This contains the logic to attach iocs_v2 dictionaries to AnalysisResult objects.

## Methods

`ThreatIntel.push_to_cb(feed_id, results)`: Input a ThreatHunter Feed ID and a list of result objects. The result objects must contain the following required attributes: `id, timestamp, title, description, and severity`. Formats the result objects into ThreatHunter `Report` objects, calls the input validation function, then sends the `Report` objects to a ThreatHunter `Feed`.

`ThreatIntel.input_validation(reports)`: Input a list of `Report` dictionaries, and outputs a boolean value indicating if the dictionaries are properly formatted for submission to a ThreatHunter `Feed`.

`AnalysisResult.attach_ioc()`

`AnalysisResult.as_dict()`

`AnalysisResult.as_dict_full()`

## Data Classes

### ThreatHunter Report
CBAPI includes the `cbapi.psc.threathunter.Report` class. ThreatHunter `Report` objects have the following required and optional parameters:

|Required|Type|Optional|Type|
|---|---|---|---|
|`id`|string|`link`|string|
|`timestamp`|integer|`[tags]`|[str]|
|`title`|string|`iocs`|IOC Format| #document IOC Format
|`description`|string|`[iocs_v2]`|[IOCv2 Format]| #document IOCv2 Format
|`severity`|integer|`visibility`|string|

ThreatHunter `Reports` can be built using dictionaries. This ThreatIntel module builds reports with the following method:

```python
report = Report(self.cb, initial_data=report_dict, feed_id=feed_id)
```

This takes an instance of `cbapi.psc.threathunter.CbThreatHunterAPI()` (`self.cb`), a report dictionary (`report_dict`), and a ThreatHunter Feed ID to send the report to (`feed_id`). The `report_dict` dictionary is generated by extracting required parameters from an `AnalysisResult` object.

### AnalysisResult

### IOC


```python
class AnalysisResult():
    """
    Models the result of an analysis performed by a connector.
    """
    def __init__(self, analysis_name, scan_time, title, description, score):
        self.id = str(analysis_name)
        self.timestamp = scan_time
        self.title = title
        self.description = description
        self.severity = score
        self.IOCsv2 = []

    def as_dictionary(self):
        return {
            "id": self.id,
            "timestamp": self.scan_time,
            "title": self.title,
            "description": self.description,
            "severity": self.score,
            "iocs_v2": [iocv2.as_dict() for iocv2 in self.IOCsv2]
        }
```
